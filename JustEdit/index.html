<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Just Write</title>
  <style>
	:root{
	  --bg:#ffffff;
	  --fg:#111111;
	  --muted:#666666;
	  --bar:#f4f4f4;
	  --btn:#e9e9e9;
	  --btnfg:#111111;
	  --border:#d9d9d9;
	}
	body.dark{
	  --bg:#0f1115;
	  --fg:#e9e9e9;
	  --muted:#a7a7a7;
	  --bar:#141823;
	  --btn:#1b2232;
	  --btnfg:#e9e9e9;
	  --border:#2a3246;
	}
	html,body{height:100%}
	body{
	  margin:0;
	  background:var(--bg);
	  color:var(--fg);
	  font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
	}
	.topbar{
	  position:sticky;
	  top:0;
	  z-index:10;
	  background:var(--bar);
	  border-bottom:1px solid var(--border);
	  padding:10px 12px;
	  display:flex;
	  gap:8px;
	  align-items:center;
	  justify-content:space-between;
	}
	.left, .right{
	  display:flex;
	  gap:8px;
	  align-items:center;
	  flex-wrap:wrap;
	}
	button{
	  border:1px solid var(--border);
	  background:var(--btn);
	  color:var(--btnfg);
	  border-radius:10px;
	  padding:8px 10px;
	  cursor:pointer;
	  user-select:none;
	}
	button:active{transform:translateY(1px)}
	.meta{
	  color:var(--muted);
	  font-size:13px;
	  white-space:nowrap;
	}
	.wrap{
	  max-width:900px;
	  margin:0 auto;
	  padding:22px 16px 40px;
	}
	textarea{
	  width:100%;
	  min-height:calc(100vh - 120px);
	  resize:none;
	  border:0;
	  outline:none;
	  background:transparent;
	  color:var(--fg);
	  font:20px/1.7 ui-serif, Georgia, "Times New Roman", Times, serif;
	  letter-spacing:0.1px;
	}
	.hint{
	  color:var(--muted);
	  font-size:13px;
	  margin-top:8px;
	}
	.kbd{
	  border:1px solid var(--border);
	  padding:1px 6px;
	  border-radius:6px;
	  font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
	  font-size:12px;
	}
  </style>
</head>
<body>
  <div class="topbar">
	<div class="left">
	  <button id="btnFocus" title="Focus mode (hides the bar)">Focus</button>
	  <button id="btnFullscreen" title="Toggle fullscreen">Fullscreen</button>
	  <button id="btnDark" title="Toggle dark mode">Dark</button>
	</div>
	<div class="right">
	  <div class="meta" id="meta">0 words • autosaved</div>
	  <button id="btnDownload" title="Download as .txt">Download</button>
	  <button id="btnClear" title="Clear text">Clear</button>
	</div>
  </div>

  <div class="wrap">
	<textarea id="editor" placeholder="Leave a note…"></textarea>
	<div class="hint">
	  Tips: <span class="kbd">⌘/Ctrl + V</span> paste • <span class="kbd">⌘/Ctrl + S</span> download • <span class="kbd">Esc</span> exit fullscreen • Focus hides the top bar.
	</div>
  </div>

  <script>
	(function () {
	  const KEY = "justwrite_text_v1";
	  const editor = document.getElementById("editor");
	  const meta = document.getElementById("meta");
	  const btnDark = document.getElementById("btnDark");
	  const btnClear = document.getElementById("btnClear");
	  const btnDownload = document.getElementById("btnDownload");
	  const btnFullscreen = document.getElementById("btnFullscreen");
	  const btnFocus = document.getElementById("btnFocus");
	  const topbar = document.querySelector(".topbar");

	  try {
		const saved = localStorage.getItem(KEY);
		if (saved) editor.value = saved;
	  } catch {}

	  function wordCount(text) {
		const t = text.trim();
		if (!t) return 0;
		return t.split(/\s+/).length;
	  }

	  function updateMeta() {
		const wc = wordCount(editor.value);
		meta.textContent = `${wc} word${wc === 1 ? "" : "s"} • autosaved`;
	  }

	  let tmr = null;
	  function scheduleSave() {
		clearTimeout(tmr);
		tmr = setTimeout(() => {
		  try { localStorage.setItem(KEY, editor.value); } catch {}
		  updateMeta();
		}, 250);
	  }

	  editor.addEventListener("input", scheduleSave);
	  updateMeta();

	  editor.addEventListener("paste", (e) => {
		if (!e.clipboardData) return;
		e.preventDefault();
		const text = e.clipboardData.getData("text/plain");
		const start = editor.selectionStart;
		const end = editor.selectionEnd;
		const before = editor.value.slice(0, start);
		const after = editor.value.slice(end);
		editor.value = before + text + after;
		const pos = start + text.length;
		editor.setSelectionRange(pos, pos);
		scheduleSave();
	  });

	  const DARK_KEY = "justwrite_dark_v1";
	  try {
		const isDark = localStorage.getItem(DARK_KEY) === "1";
		document.body.classList.toggle("dark", isDark);
	  } catch {}

	  btnDark.addEventListener("click", () => {
		const nowDark = !document.body.classList.contains("dark");
		document.body.classList.toggle("dark", nowDark);
		try { localStorage.setItem(DARK_KEY, nowDark ? "1" : "0"); } catch {}
	  });

	  btnClear.addEventListener("click", () => {
		if (!confirm("Clear all text?")) return;
		editor.value = "";
		try { localStorage.setItem(KEY, ""); } catch {}
		updateMeta();
		editor.focus();
	  });

	  function downloadText(filename, text) {
		const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
		const url = URL.createObjectURL(blob);
		const a = document.createElement("a");
		a.href = url;
		a.download = filename;
		document.body.appendChild(a);
		a.click();
		a.remove();
		URL.revokeObjectURL(url);
	  }

	  btnDownload.addEventListener("click", () => {
		const stamp = new Date().toISOString().slice(0,10);
		downloadText(`just-write-${stamp}.txt`, editor.value);
	  });

	  window.addEventListener("keydown", (e) => {
		const key = e.key.toLowerCase();
		if ((e.ctrlKey || e.metaKey) && key === "s") {
		  e.preventDefault();
		  btnDownload.click();
		}
		if (key === "escape") {
		  if (document.fullscreenElement) document.exitFullscreen();
		}
	  });

	  btnFullscreen.addEventListener("click", async () => {
		try {
		  if (!document.fullscreenElement) {
			await document.documentElement.requestFullscreen();
		  } else {
			await document.exitFullscreen();
		  }
		} catch {}
		editor.focus();
	  });

	  let focusOn = false;
	  btnFocus.addEventListener("click", () => {
		focusOn = !focusOn;
		topbar.style.display = focusOn ? "none" : "flex";
		editor.focus();
	  });

	  window.addEventListener("mousemove", (e) => {
		if (!focusOn) return;
		if (e.clientY <= 10) topbar.style.display = "flex";
	  });
	  topbar.addEventListener("mouseleave", () => {
		if (focusOn) topbar.style.display = "none";
	  });

	  editor.focus();
	})();
  </script>
</body>
</html>
